# 大数据领域 建模综述

## 为什么需要数据建模

**数据模型就是数据组织和存储方法，它强调从业务，数据存储和使用角度合理存储数据**

好处：

- 性能：帮助我们快速查询所需要的数据，减少数据的 I/O 吞吐；
- 成本：减少不必要的数据冗余，也能实现计算结果复用，极大的降低大数据系统中的存储和计算成本；
- 效率：良好的数据模型及大的改善了使用数据的体验，提高使用数据的效率；
- 质量：改善数据统计口径的不一致，减少数据错误计算的可能性

## OLTP和OLAP系统的区别看模型方法论的选择

OLTP系统通常面向的主要数据操作是随机读写，主要采用满足3NF的实体关系模型存储数据，从而在事务处理中解决数据的冗余和一致性问题；

OLAP系统面向的主要数据操作是批量读写，事物处理中的一致性不是OLAP关注的，其主要关注数据的整合以及在一次性的复杂大数据查询和处理中的性能，它需要采用一些不同的数据建模方法；

## 典型的数据建模方法

### ER建模

它是站在站在企业角度面性主题的抽象，而不是针对某个具体业务流程的实体对象那个关系的抽象，其有一下特点：

- 需要全面了解企业业务和数据
- 实施周期非常长
- 对建模人员的能力要求非常高

### 纬度建模

纬度建模从分许决策出发的需求构建的模型，为需求分析服务，

其设计可以分为几个步骤：

- 选择需要进行分析决策的业务过程

- 选择粒度

- 识别维度

- 选择事实

  

### 名词术语

数据域：指面向业务分析，将业务过程还活着纬度进行抽象的集合；

业务过程：指企业的业务活动事件，如下单、支付、退款等都是业务过程；

时间周期：用来明确诗句统计的时间范围或者时间点，如近30天，自然周等；

修饰类型：是对修饰词的一种抽象划分，修饰类型从属于某个业务领域

修饰词：指除了统计纬度以外指标的业务场景限定抽象，修饰词属于一种修饰类型

度量/原子指标：原子指标和度量含义相同，基于某一业务时间行为下的度量，是业务定义中不可再拆分的指标，具有明确业务含义的名词

纬度：纬度是度量的环境，用来反映业务的一类属性，这列属性的集合构成了一个纬度，也称为实体对象，纬度属于一个数据域，如地理纬度，时间维度

纬度属性：纬度属性隶属于一个纬度，

派生指标：派生指标 = 一个原子指标 + 多个修饰词 + 时间周期，可以理解为对原子指标业务统计范围的圈定；

### 模型设计

模型设计的维度设计主要以维度建模理论为基础，基于维度数据模型总线架构，构建一致性的维度和事实

- 模型层次
  - 数据操作层（ODS）
    - 把操作系统数据几乎无处理的存放在数据仓库系统中
  - 公共维度模型层（CDM）-->  细分：DWD 明细数据层 和 DWS 汇总数据层
    - 采用维度模型方法作为理论基础，更多的采用一些维度退化手法，将维度退化至事实表中，减少事实表与维度表的关联，提高明细数据表易用性，同时在汇总数据层加强指标的维度退化，采用更多的宽表化手段构建公共指标数据层，提升公共指标的复用性，减少重复开发。
    - 作用：
    - 组合相关和相似的数据：采用明细宽表，复用关联计算，减少扫描
    - 公共指标统一加工：构建命名规范，口径统一 和算法统一的指标，为上层数据产品，应用 和服务提供公共指标，建立逻辑汇总宽表
    - 建立一致性维度：建立一致性的数据分析维表，降低数据计算孔径算法不同意的风险
  - 应用数据层（ADS）：
    - 存放数据产品个性化的统计指标数据，

### 基本原则

1. 高内聚低耦合
2. 核心模型与扩展模型
3. 公共处理逻辑下沉和单一
4. 成本与性能平衡
5. 数据可回滚
6. 一致性
7. 命名清晰，可理解



### 模型实施

业界常用的模型实施过程

Kimball 维度建模主要探讨需求分析，高层模型，详细模型 和模型审核整个过程

构建维度模型一般要经历三、四个阶段

1. 第一阶段：高层设计时期	
   - 定义业务过程维度模型的范围，提供每一种星型模型的技术和功能描述
   - 直接产出目标是创建高维度模型图，它是对业务过程中的维表和事实表的图形描述，确定为表创建初始属性列表，为每个事实表穿件提议度量；
2. 第二阶段：详细模型设计时期
   - 对每个星型模型添加属性和度量信息
3. 第三阶段：进行模型的审核和再设计和验证工作
4. 第四阶段：产生详细设计文档，提交ETL设计和开发



## 纬度设计

纬度是用于分析事实所需要的多样环境

纬度所包含的表示维度的列，成为纬度属性，维度属性是查询约束条件，分组，和报表标签生成的基本来源，是数据易用性的关键；

如何获得纬度和纬度属性：

1. 可以从报表中获取
2. 可以在业务人员交谈中发现维度或维度属性

### 维度的基本设计方法：

维度设计的过程就是确认维度属性的过程

设计维度的步骤：

1. 选择维度或新建维度：
   1. 作为维度建模的核心，在企业级数据仓库中必须保证维度的唯一性；
2. 确认主维度
   1. 可与前台商品表同步，为主为表
3. 确认相关维度
   1. 根据对业务的梳理，确认主维表和哪些表存在关联关系，并根据其中的某些表用于生成维度属性。
4. 确认维度属性
   1. 主要有两个阶段：
      1. 从主维表中选择维度属性或深村新的维度属性
      2. 从相关为表中选择维度或生成新的维度属性

**确认维度属性几点提示：**

1. 尽可能生成丰富的维度属性
2. 尽可能多的给出包含一些富有意义的文字性描述
3. 区分数值型属性和事实
4. 尽可能沉淀出通用的维度属性

### 维度整合

数据仓库的重要数据来源是大量的，分散的面向应用的操作型环境，不同应用在设计过程中，可以自由决策，主要满足本应用的需求，很少会考虑和其他系统进行数据集成。应用之间的差异主要表现在：

1. 

